**Corrections Applied:**
*   `gorun main.go` → `go run main.go`
*   `k comma v` → `k v` (interpreting comma as separator in spoken command example)
*   `object not expired double equal to minus one` → `object.expires_at == -1` (interpreting variable name and comparison)

---

1.  **Redis Command Implementation Focus:** The video details the implementation of three core Redis commands: `GET`, `SET`, and `TTL`, focusing on concurrent client connections and handling edge cases.
2.  **Redis Server and Client Interaction:**
    *   A Redis server is demonstrated running on port `6379`.
    *   The `redis-cli` is used to connect to the server.
    *   Commands are sent from the client to the server as an array of strings.
3.  **`SET` Command Functionality and Edge Cases:**
    *   **Basic Usage:** `SET key value` stores a string value associated with a key.
    *   **Response:** On successful execution, `SET` returns an `OK` reply, which is a simple string response.
    *   **`EX` (Expiry) Parameter:** The `SET` command supports an `EX` parameter to set a time-to-live (TTL) for the key in seconds.
        *   Example: `SET k v EX 5` sets key `k` with value `v` to expire after 5 seconds.
        *   **Expiration Handling:** When a key expires, subsequent `GET` requests for that key return `nil`.
    *   **Argument Validation:**
        *   If the number of arguments for `SET` is less than or equal to one (i.e., missing key or value), a syntax error is returned.
        *   If the expiry duration provided to `EX` is not a valid integer or is out of range (e.g., a string instead of a number), an error like "value is not an integer or is out of range" is returned.
4.  **`GET` Command Functionality and Edge Cases:**
    *   **Argument Expectation:** The `GET` command expects exactly one argument: the key to retrieve.
    *   **Response for Non-existent Key:** If the key does not exist in the store, `GET` returns a `RESP nil` response.
    *   **Response for Expired Key:** If a key exists but has expired (its `expires_at` timestamp is in the past), `GET` also returns a `RESP nil` response, treating it the same as a non-existent key from the client's perspective.
    *   **Response for Valid Key:** If the key exists and is not expired, `GET` returns the associated value, typically encoded as a `bulk string`.
5.  **`TTL` (Time To Live) Command Functionality and Edge Cases:**
    *   **Purpose:** The `TTL` command reports the remaining time in seconds until a key expires.
    *   **Argument Expectation:** `TTL` expects exactly one argument: the key for which to check the TTL.
    *   **Return Values:**
        *   **`-2`:** Returned if the key does not exist (similar to `GET` returning `nil` for a non-existent key).
        *   **`-1`:** Returned if the key exists but no expiration time has been set for it.
        *   **`N` (non-negative integer):** Returned if the key exists and has an expiration set. `N` represents the number of seconds remaining until expiration. This value decrements over time.
    *   **Handling Expired Keys:** If `TTL` is called on a key that has already expired (but not yet deleted from storage), the computed duration left will be less than zero. In this scenario, the command returns `-2`, indicating the key is effectively non-existent.
6.  **Implementation Architecture - `store.go`:**
    *   **`store.go` File:** This file is responsible for managing all data stored in the Redis implementation.
    *   **Data Structure:** A hash map (`map[string]*Object`) is used as the primary data structure to store key-value pairs. This provides efficient key lookups.
    *   **`Object` Struct:** A custom struct `Object` is defined to hold data and its associated expiration information.
        *   `value`: An `interface{}` type, allowing storage of any data type.
        *   `expires_at`: A `timestamp` (in epoch milliseconds) indicating the absolute time when the object will expire. A value of `-1` signifies that the key should never expire.
    *   **`NewObject` Function:**
        *   Creates a new `Object` instance.
        *   Accepts a `value`, a `duration` (in milliseconds), and an optional `expiration` parameter.
        *   Calculates the absolute `expires_at` time by adding the `duration` (if provided) to the current time (`time.Now().UnixMilli()`).
        *   Handles the case where no duration is passed, setting `expires_at` to `-1` (never expire).
    *   **`Put` Function:**
        *   Adds or updates an `Object` in the store's hash map using the provided key.
        *   Designed to be extensible, potentially supporting multiple internal hash maps in future implementations.
    *   **`Get` Function:**
        *   Retrieves an `Object` from the store's hash map given a key.
        *   Returns `nil` if the key is not found in the map.
7.  **`SET` Command Implementation Details (`eval.go`):**
    *   **Argument Parsing:** Parses the input arguments (key, value, optional parameters like `EX`).
    *   **Key and Value Extraction:** Assumes `args[0]` is the key and `args[1]` is the value.
    *   **Expiry Parsing:**
        *   Iterates through arguments starting from index 2 to find `EX` (case-insensitive).
        *   If `EX` is found, the subsequent argument is parsed as an integer representing seconds.
        *   Performs syntax checks: ensures an argument follows `EX` and that it's a valid 64-bit integer.
        *   Converts the parsed expiry duration from seconds to milliseconds by multiplying by 1000 for storage.
        *   If `EX` is not provided, the expiry duration defaults to `-1` (never expire).
    *   **Object Creation:** Calls `NewObject` to create a store `Object` with the extracted value and calculated expiry duration in milliseconds.
    *   **Storing the Object:** Calls `store.Put(key, obj)` to add the newly created `Object` to the hash map.
    *   **Response:** Returns an `OK` reply (`"+OK\r\n"`) to the client.
8.  **`GET` Command Implementation Details (`eval.go`):**
    *   **Argument Validation:** Checks for exactly one argument (the key). Returns a syntax error if validation fails.
    *   **Retrieval:** Calls `store.Get(key)` to fetch the `Object`.
    *   **Nil/Expired Check:**
        *   If the retrieved `Object` is `nil` (key not found), returns a `RESP nil` response.
        *   If `Object.expires_at` is not `-1` and is less than the current millisecond timestamp (`time.Now().UnixMilli()`), the key is considered expired. In this case, it also returns a `RESP nil` response.
    *   **Value Return:** If the object exists and is not expired, its `value` is returned, encoded according to the RESP specification (e.g., as a bulk string for string values).
9.  **`TTL` Command Implementation Details (`eval.go`):**
    *   **Argument Validation:** Checks for exactly one argument (the key). Returns a syntax error if validation fails.
    *   **Retrieval:** Calls `store.Get(key)` to fetch the `Object`.
    *   **Handling Non-existent Keys:** If the `Object` is `nil`, returns a `RESP integer` response of `-2`.
    *   **Handling Keys Without Expiry:** If `Object.expires_at` is `-1` (meaning no expiration is set), returns a `RESP integer` response of `-1`.
    *   **Calculating Remaining Time:**
        *   Calculates the duration left in milliseconds: `duration_ms = Object.expires_at - time.Now().UnixMilli()`.
        *   **Handling Already Expired Keys:** If `duration_ms` is less than 0, it means the key has expired. In this case, returns a `RESP integer` response of `-2` (treating it as non-existent).
        *   **Returning Remaining Time:** If `duration_ms` is non-negative, it's converted to seconds (integer division) and returned as a `RESP integer` response.
10. **RESP Encoding Enhancements:**
    *   **`encode.go`:** Modified to support encoding `int64` types.
    *   **Integer Encoding:** `int64` values are encoded starting with a colon (`:`) followed by the string representation of the integer, terminated by CRLF (`\r\n`). For example, `-2` is encoded as `:-2\r\n`.
    *   **Null Encoding:** A constant `RESPNil` (`"$-1\r\n"`) is used for `RESP nil` responses to avoid repeated creation.
11. **Demonstration:**
    *   The custom server is run using `go run main.go`.
    *   `redis-cli` connects to the custom server on port `7379`.
    *   **`SET k v`:** Executes successfully, returning `OK`.
    *   **`GET k`:** Returns `v` as a bulk string.
    *   **`TTL k`:** Returns `-1` as the expiration is not set.
    *   **`SET k v EX 10`:** Executes successfully, setting key `k` with value `v` and a 10-second expiry.
    *   **`GET k`:** Returns `v` while the key is still valid.
    *   **`TTL k`:** Returns decreasing integer values (e.g., 9, 7, 6, 4) as seconds to expiration.
    *   **After Expiration:** `GET k` returns `nil`. `TTL k` returns `-2`, indicating the key has expired and is effectively non-existent.
12. **Future Work Indicated:**
    *   The implementation currently handles key expiration logic (returning nil/minus two) but does not explicitly `DELETE` expired keys from storage.
    *   The next steps will involve implementing the `DEL` command and key eviction mechanisms.
13. **Source Code Reference:** The complete source code for these changes is available on GitHub at `github.com/dicedb/dice`, specifically the fifth commit from the beginning.